# ููุฎุต ุงูุชุญุณููุงุช ุนูู ูุธุงู ERP

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุดุงููุฉ ูุชุญุณูู ููุทู ุญูุธ ูุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงููุธุงู ูุถูุงู:
- **ุงูุณูุงูุฉ**: ููุน ููุฏุงู ุงูุจูุงูุงุช ุฃู ุนุฏู ุงูุงุชุณุงู
- **ุงูููุซูููุฉ**: ูุนุงูุฌุฉ ุตุญูุญุฉ ููุฃุฎุทุงุก
- **ุงูุฃูุงู**: ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- **ุงูุชุฒุงูู**: ููุน ุชุนุงุฑุถุงุช ุงูุชุนุฏูู ุงููุชุฒุงูู

---

## ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. โ **ูุนุงููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Transactions)**

**ุงููุดููุฉ:**
- ูุง ุชูุฌุฏ ูุนุงููุงุช ููุนูููุงุช ูุชุนุฏุฏุฉ ุงูุฎุทูุงุช
- ูู `ordersService.createOrder()`: ุชุญุฏูุซ ุงููุฎุฒูู ูุญุฏุซ ูุจู ุญูุธ ุงูุทูุจ
- ุฅุฐุง ูุดู ุญูุธ ุงูุทูุจุ ุงููุฎุฒูู ูุจูู ูุญุฏุซุงู (ุนุฏู ุงุชุณุงู)

**ุงูุญู:**
- โ ุฅูุดุงุก `transactionManager.js` ูุฅุฏุงุฑุฉ ุงููุนุงููุงุช
- โ ุฌููุน ุงูุนูููุงุช ูุชุนุฏุฏุฉ ุงูุฎุทูุงุช ุชุณุชุฎุฏู ุงููุนุงููุงุช
- โ ุขููุฉ Rollback ุชููุงุฆูุฉ ุนูุฏ ุงููุดู
- โ ูุธุงู Locking ูููุน ุงูุชุนุงุฑุถุงุช

**ูุซุงู:**
```javascript
// ูุจู: ูุง ุชูุฌุฏ ูุนุงููุงุช
orderData.items.forEach(item => {
  inventoryService.adjustQuantity(item.productId, -item.quantity)
})
this.orders.push(newOrder) // ุฅุฐุง ูุดู ููุงุ ุงููุฎุฒูู ูุญุฏุซ ุจุงููุนู!

// ุจุนุฏ: ูุน ูุนุงููุงุช
await transactionManager.executeTransaction(transactionId, [
  // ุชุญุฏูุซ ุงููุฎุฒูู
  ...orderData.items.map(item => ({
    operationFn: async () => inventoryService.adjustQuantity(...),
    rollbackFn: async () => inventoryService.adjustQuantity(...) // ุงุณุชุฑุฌุงุน
  })),
  // ุญูุธ ุงูุทูุจ
  {
    operationFn: async () => this.orders.push(newOrder),
    rollbackFn: () => this.orders.pop() // ุญุฐู ุนูุฏ ุงููุดู
  }
])
```

---

### 2. โ **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (Data Validation)**

**ุงููุดููุฉ:**
- ุงูุชุญูู ููุท ุนูู ูุณุชูู ุงููููุฐุฌ (Form)
- ูุง ููุฌุฏ ุชุญูู ูู ุงูุฎุฏูุงุช
- ูููู ุฅุฏุฎุงู ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ ูุจุงุดุฑุฉ ูู ุงูุฎุฏูุงุช
- ูุง ููุฌุฏ ุชุญูู ูู ุชูุฑุฏ SKU ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

**ุงูุญู:**
- โ ุฅูุดุงุก `validators.js` ูุน ุฏูุงู ุชุญูู ุดุงููุฉ
- โ ุงูุชุญูู ูู ูู ุนูููุฉ Create/Update
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- โ ุงูุชุญูู ูู:
  - ุงูุญููู ุงููุทููุจุฉ
  - ุฃููุงุน ุงูุจูุงูุงุช
  - ุงูููู ุงูููุทููุฉ (ูุซู: ุณุนุฑ ุงูุจูุน > ุณุนุฑ ุงูุดุฑุงุก)
  - ุชูุฑุฏ SKU ูุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  - ุชููุฑ ุงููููุฉ ูู ุงููุฎุฒูู ุนูุฏ ุฅูุดุงุก ุงูุทูุจ

**ูุซุงู:**
```javascript
// ูุจู: ูุง ููุฌุฏ ุชุญูู
addProduct(productData) {
  this.products.push({ ...productData })
  // ูููู ุฅุฏุฎุงู ุฃู ุจูุงูุงุช!
}

// ุจุนุฏ: ูุน ุงูุชุญูู
async addProduct(productData) {
  const validation = validateProduct(productData)
  if (!validation.isValid) {
    return { success: false, error: validation.errors.join(', ') }
  }
  // ... ุจุงูู ุงูููุฏ
}
```

---

### 3. โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก (Error Handling)**

**ุงููุดููุฉ:**
- ูุนุงูุฌุฉ ุบูุฑ ูุชุณูุฉ ููุฃุฎุทุงุก
- ุจุนุถ ุงูุฏูุงู ุชุฑุฌุน `null`ุ ุฃุฎุฑู `false`
- ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- ูุง ูุชู ุงูุชุญูู ูู ูุฌุงุญ ุงูุนูููุงุช ูุจู ุงููุชุงุจุนุฉ

**ุงูุญู:**
- โ ุชูุณูู ููุญุฏ ููุงุณุชุฌุงุจุงุช: `{ success, error, errorCode }`
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูุน `try/catch`
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- โ ุฑููุฒ ุฃุฎุทุงุก ููุชุนุงูู ุงูุจุฑูุฌู (`VERSION_MISMATCH`, `VALIDATION_ERROR`, ุฅูุฎ)

**ูุซุงู:**
```javascript
// ูุจู: ูุนุงูุฌุฉ ุบูุฑ ูุชุณูุฉ
updateProduct(id, updates) {
  const index = this.products.findIndex(...)
  if (index === -1) return null // โ
  this.products[index] = updated
  this.saveToLocalStorage() // โ ูุง ูุชู ุงูุชุญูู ูู ุงููุฌุงุญ
  return updated
}

// ุจุนุฏ: ูุนุงูุฌุฉ ุดุงููุฉ
async updateProduct(id, updates, expectedVersion) {
  try {
    // ุงูุชุญูู ูู ุงููุฌูุฏ
    if (index === -1) {
      return { success: false, error: 'ุงูููุชุฌ ุบูุฑ ููุฌูุฏ', errorCode: 'PRODUCT_NOT_FOUND' }
    }
    
    // ุงูุชุญูู ูู ุงููุณุฎุฉ
    if (expectedVersion !== null && currentProduct._version !== expectedVersion) {
      return { success: false, error: 'ุชู ุงูุชุนุฏูู ุจูุงุณุทุฉ ูุณุชุฎุฏู ุขุฎุฑ', errorCode: 'VERSION_MISMATCH' }
    }
    
    // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
    const validation = validateProduct(updatedData)
    if (!validation.isValid) {
      return { success: false, error: validation.errors.join(', '), errorCode: 'VALIDATION_ERROR' }
    }
    
    // ุงูุญูุธ ูุน ุงูุชุญูู
    const saveResult = await this.saveToLocalStorage(expectedVersion)
    if (!saveResult.success) {
      throw new Error(saveResult.error)
    }
    
    return { success: true, product: updatedProduct, version: updatedProduct._version }
  } catch (error) {
    return { success: false, error: error.message, errorCode: 'UPDATE_FAILED' }
  }
}
```

---

### 4. โ **Race Conditions (ุชุนุงุฑุถุงุช ุงูุชุนุฏูู ุงููุชุฒุงูู)**

**ุงููุดููุฉ:**
- ูุง ููุฌุฏ ูุธุงู ูููุน ุงูุชุนุฏูู ุงููุชุฒุงูู
- ุนุฏุฉ ูุณุชุฎุฏููู ูููููู ุชุนุฏูู ููุณ ุงูุณุฌู
- ุงูุชุนุฏูู ุงูุฃุฎูุฑ ููุชุจ ููู ุงูุชุนุฏููุงุช ุงูุณุงุจูุฉ
- ูุง ููุฌุฏ ุชุญูู ูู ุงููุณุฎุฉ

**ุงูุญู:**
- โ **Optimistic Locking** ุจุงุณุชุฎุฏุงู `_version`
- โ ูู ุชุญุฏูุซ ูุฒูุฏ ุฑูู ุงููุณุฎุฉ
- โ ุงูุชุญูู ูู ุงููุณุฎุฉ ูุจู ุงูุชุญุฏูุซ
- โ ุฑุณุงูุฉ ูุงุถุญุฉ ุนูุฏ ุชุนุงุฑุถ ุงููุณุฎุฉ
- โ ูุธุงู Locking ูู `transactionManager` ูููุน ุงูุชุนุงุฑุถุงุช

**ูุซุงู:**
```javascript
// ูุจู: ูุง ููุฌุฏ ุชุญูู ูู ุงููุณุฎุฉ
updateProduct(id, updates) {
  this.products[index] = { ...this.products[index], ...updates }
  // โ ูููู ุฃู ููุชุจ ููู ุชุนุฏููุงุช ุฃุฎุฑู
}

// ุจุนุฏ: ูุน Optimistic Locking
async updateProduct(id, updates, expectedVersion) {
  const currentProduct = this.products[index]
  
  // ุงูุชุญูู ูู ุงููุณุฎุฉ
  if (expectedVersion !== null && currentProduct._version !== expectedVersion) {
    return {
      success: false,
      error: 'ุชู ุชุนุฏูู ุงูููุชุฌ ุจูุงุณุทุฉ ูุณุชุฎุฏู ุขุฎุฑ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.',
      errorCode: 'VERSION_MISMATCH',
      currentVersion: currentProduct._version
    }
  }
  
  // ุงูุชุญุฏูุซ ูุฒูุฏ ุงููุณุฎุฉ ุชููุงุฆูุงู
  const updatedProduct = { ...currentProduct, ...updates, _version: currentProduct._version + 1 }
}
```

---

### 5. โ **ูุดููุฉ ุนุฏู ุญูุธ ุงูุนููุงุก**

**ุงููุดููุฉ:**
- `CustomersPage` ูุณุชุฎุฏู `useState` ูุญูู ููุท
- ุงูุจูุงูุงุช ูุง ุชูุญูุธ ูู localStorage
- ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉุ ุชููุฏ ุฌููุน ุงูุชุนุฏููุงุช

**ุงูุญู:**
- โ ุฅูุดุงุก `customersService.js` ูุงูู
- โ ุญูุธ ูู localStorage ูุน `dbService`
- โ ุชุญุฏูุซ `CustomersPage` ูุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ
- โ ุฌููุน ุงูุนูููุงุช (Create/Update/Delete) ูุญููุธุฉ

---

### 6. โ **OrdersPage ูุง ูุณุชุฎุฏู ordersService**

**ุงููุดููุฉ:**
- `OrdersPage` ูุณุชุฎุฏู `useState` ูุญูู
- ูุง ูุชู ุชุญุฏูุซ ุงููุฎุฒูู ุนูุฏ ุฅูุดุงุก ุงูุทูุจ
- ูุง ููุฌุฏ ุชุญูู ูู ุชููุฑ ุงููููุฉ

**ุงูุญู:**
- โ ุชุญุฏูุซ `OrdersPage` ูุงุณุชุฎุฏุงู `ordersService`
- โ ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ุงูุทูุจ
- โ ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ ูุจู ุงูุฅุถุงูุฉ
- โ ุงุณุชุฑุฌุงุน ุงููุฎุฒูู ุนูุฏ ุญุฐู ุงูุทูุจ

---

## ุงููููุงุช ุงูุฌุฏูุฏุฉ

1. **`src/services/transactionManager.js`**
   - ุฅุฏุงุฑุฉ ุงููุนุงููุงุช
   - ูุธุงู Locking
   - Rollback ุชููุงุฆู

2. **`src/services/validators.js`**
   - ุฏูุงู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
   - `validateProduct()`
   - `validateOrder()`
   - `validateCustomer()`
   - ุงูุชุญูู ูู ุงูุชูุฑุฏ (SKUุ Email)

3. **`src/services/customersService.js`**
   - ุฎุฏูุฉ ูุงููุฉ ูุฅุฏุงุฑุฉ ุงูุนููุงุก
   - Create/Update/Delete ูุน ุงูุชุญูู ูุงููุนุงููุงุช

## ุงููููุงุช ุงููุญุฏุซุฉ

1. **`src/services/dbService.js`**
   - ุฅุถุงูุฉ Optimistic Locking (`_version`)
   - ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
   - ุฅุถุงูุฉ `getStorageQuota()` ููุชุญูู ูู ุงููุณุงุญุฉ
   - Batch operations

2. **`src/services/inventoryService.js`**
   - ุฌููุน ุงูุฏูุงู ุฃุตุจุญุช `async`
   - ุฅุถุงูุฉ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
   - ุงุณุชุฎุฏุงู ุงููุนุงููุงุช
   - Optimistic Locking
   - ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ

3. **`src/services/ordersService.js`**
   - ุฅุตูุงุญ ูุดููุฉ ุชุญุฏูุซ ุงููุฎุฒูู ูุจู ุญูุธ ุงูุทูุจ
   - ุงุณุชุฎุฏุงู ุงููุนุงููุงุช ูุถูุงู ุงูุงุชุณุงู
   - ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ
   - ุงุณุชุฑุฌุงุน ุงููุฎุฒูู ุนูุฏ ุงูุญุฐู

4. **`src/pages/InventoryPage.tsx`**
   - ุชุญุฏูุซ ูุงุณุชุฎุฏุงู ุงูุฏูุงู `async`
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ุงููุงุฌูุฉ
   - ุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

5. **`src/pages/CustomersPage.tsx`**
   - ุงุณุชุฎุฏุงู `customersService` ุจุฏูุงู ูู state ูุญูู
   - ุญูุธ ุงูุจูุงูุงุช ูู localStorage
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

6. **`src/pages/OrdersPage.tsx`**
   - ุงุณุชุฎุฏุงู `ordersService` ุจุฏูุงู ูู state ูุญูู
   - ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู
   - ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ

---

## ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ

### 1. **ุฅุฏุงุฑุฉ ูุณุงุญุฉ ุงูุชุฎุฒูู**
- ุงูุชุญูู ูู `localStorage` quota ูุจู ุงูุญูุธ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุงูุชูุงุก ุงููุณุงุญุฉ

### 2. **ุฑุณุงุฆู ุงูุฎุทุฃ**
- ุฌููุน ุงูุฑุณุงุฆู ุจุงูุนุฑุจูุฉ
- ุฑุณุงุฆู ูุงุถุญุฉ ููููุฏุฉ
- ุฑููุฒ ุฃุฎุทุงุก ููุชุนุงูู ุงูุจุฑูุฌู

### 3. **ุงูุฃุฏุงุก**
- ุนูููุงุช ุบูุฑ ูุชุฒุงููุฉ (`async/await`)
- ูุง ุชูุฌุฏ ุนูููุงุช ุญุธุฑ

### 4. **ุงูููุซูููุฉ**
- Rollback ุชููุงุฆู ุนูุฏ ุงููุดู
- ุงูุชุญูู ูู ุงููุณุฎุฉ ูุจู ุงูุชุญุฏูุซ
- ูุนุงููุงุช ูุถูุงู ุงูุงุชุณุงู

---

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุฅูุดุงุก ููุชุฌ ุฌุฏูุฏ:
```javascript
const result = await inventoryService.addProduct({
  name: 'ููุชุฌ ุฌุฏูุฏ',
  sku: 'SKU-001',
  purchasePrice: 100,
  sellingPrice: 150,
  quantity: 10,
  // ...
})

if (result.success) {
  console.log('ุชู ุงูุฅุถุงูุฉ:', result.product)
} else {
  console.error('ุฎุทุฃ:', result.error)
  // result.errorCode: 'VALIDATION_ERROR', 'DUPLICATE_SKU', ุฅูุฎ
}
```

### ุชุญุฏูุซ ููุชุฌ:
```javascript
const currentVersion = product._version
const result = await inventoryService.updateProduct(
  productId,
  { quantity: 20 },
  currentVersion // ููุชุญูู ูู ุนุฏู ุงูุชุนุฏูู ุงููุชุฒุงูู
)

if (result.success) {
  console.log('ุชู ุงูุชุญุฏูุซ:', result.product)
  console.log('ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ:', result.version)
} else if (result.errorCode === 'VERSION_MISMATCH') {
  // ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู
  loadProducts()
}
```

### ุฅูุดุงุก ุทูุจ:
```javascript
const result = await ordersService.createOrder({
  customerName: 'ุฃุญูุฏ ูุญูุฏ',
  customerPhone: '0501234567',
  items: [
    { productId: 'PROD-001', productName: 'ููุชุฌ 1', quantity: 2, unitPrice: 100, total: 200 }
  ]
})

if (result.success) {
  console.log('ุชู ุฅูุดุงุก ุงูุทูุจ:', result.order)
  // ุงููุฎุฒูู ูุญุฏุซ ุชููุงุฆูุงู!
} else {
  console.error('ุฎุทุฃ:', result.error)
  // ูุฏ ูููู: 'VALIDATION_ERROR', 'INVENTORY_ERROR' (ูููุฉ ุบูุฑ ูุชููุฑุฉ)
}
```

---

## ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู ุงูุญุฑุฌุฉ:
- โ **ูุนุงููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุฌููุน ุงูุนูููุงุช ูุชุนุฏุฏุฉ ุงูุฎุทูุงุช ูุญููุฉ
- โ **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช**: ุชุญูู ุดุงูู ูู ุฌููุน ุงููุณุชููุงุช
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ูุนุงูุฌุฉ ุดุงููุฉ ูููุญุฏุฉ
- โ **Race Conditions**: Optimistic Locking ูููุน ุงูุชุนุงุฑุถุงุช
- โ **ุญูุธ ุงูุนููุงุก**: ุฎุฏูุฉ ูุงููุฉ ูุน ุญูุธ ูู localStorage
- โ **ุชุญุฏูุซ ุงููุฎุฒูู**: ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุฅูุดุงุก/ุญุฐู ุงูุทูุจุงุช

ุงููุธุงู ุงูุขู ุฃูุซุฑ ุฃูุงูุงู ูููุซูููุฉ ูุงุณุชูุฑุงุฑุงู! ๐
